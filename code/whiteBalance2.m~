function [ I_whiteBalance ] = whiteBalance2( I )
% the input I is a bayer raw matrix
%separate R G B channel
[m, n] = size(I);
red_mask = repmat([1 0;0 0], floor(m/2), floor(n/2));
green_mask = repmat([0 1;1 0], floor(m/2), floor(n/2));
blue_mask = repmat([0 0;0 1], floor(m/2), floor(n/2));
rawR = red_mask .* I;
rawG = green_mask .* I;
rawB = blue_mask .* I;
% white balance
% find meanR, G, B
posR = rawR > 0;
meanR = sum(rawR(:)) * 1.0 / sum(posR(:));
posG = rawG > 0;
meanG = sum(rawG(:)) * 1.0 / sum(posG(:));
posB = rawB > 0;
meanB = sum(raw())

% white balance
% make means of all color channels the same
meanR = mean2(rawR);
meanG = mean2(rawG);
meanB = mean2(rawB);

maxMean = max(meanR, max(meanG, meanB));

rawR = double(rawR) * maxMean / meanR;
rawG = double(rawG) * maxMean / meanG;
rawB = double(rawB) * maxMean / meanB;

end

